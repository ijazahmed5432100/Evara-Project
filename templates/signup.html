{% load socialaccount %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jamilah - Create an Account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f9f9f9;
            color: #333;
        }
        
        .signup-container {
            max-width: 550px;
            margin: 2rem auto;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .signup-form {
            padding: 2.5rem;
            background-color: white;
        }
        
        .brand-logo {
            width: 160px;
            margin-bottom: 1.5rem;
        }
        
        .form-title {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1e3a29;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 0;
        }
        
        .form-floating {
            margin-bottom: 1rem;
            width: 100%;
        }
        
        .form-floating > .form-control {
            padding: 1rem 0.75rem;
            height: calc(3rem + 2px);
            line-height: 1.25;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .form-floating > label {
            padding: 1rem 0.75rem;
        }
        
        .btn-signup {
            background-color: #1e3a29;
            border: none;
            color: white;
            width: 100%;
            padding: 0.7rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-signup:hover {
            background-color: #2a4d37;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(42, 77, 55, 0.2);
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: #6c757d;
            font-size: 14px;
        }
        
        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .divider::before {
            margin-right: 1rem;
        }
        
        .divider::after {
            margin-left: 1rem;
        }
        
        .btn-social {
            padding: 0.7rem;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
            color: #333;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-social:hover {
            background-color: #f5f5f5;
            border-color: #d0d0d0;
        }
        
        .signin-link {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 14px;
        }
        
        .signin-link a {
            color: #1e3a29;
            text-decoration: none;
            font-weight: 500;
        }
        
        .signin-link a:hover {
            text-decoration: underline;
        }
        
        .terms-check {
            margin-bottom: 1.5rem;
            font-size: 14px;
        }
        
        .form-check-input:checked {
            background-color: #1e3a29;
            border-color: #1e3a29;
        }
        
        .validation-error {
            color: #dc3545;
            margin-top: -0.5rem;
            margin-bottom: 0.5rem;
            font-size: 12px;
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="signup-container">
            <div class="signup-form">
                <h1 class="form-title">Create an Account</h1>

                {% if messages %}
                <div class="messages mb-3">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                </div>
                {% endif %}

                <form method="POST" id="signupForm" novalidate>
                    {% csrf_token %}

                    <div class="form-floating">
                        <input type="text" class="form-control" name="username" id="username" placeholder="Username" required>
                        <label for="username">Username</label>
                        <div id="username-error" class="validation-error"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-floating">
                            <input type="text" class="form-control" name="first_name" id="first_name" placeholder="First Name" required>
                            <label for="first_name">First Name</label>
                            <div id="first-name-error" class="validation-error"></div>
                        </div>

                        <div class="form-floating">
                            <input type="text" class="form-control" name="last_name" id="last_name" placeholder="Last Name" required>
                            <label for="last_name">Last Name</label>
                            <div id="last-name-error" class="validation-error"></div>
                        </div>
                    </div>

                    <div class="form-floating">
                        <input type="email" class="form-control" name="email" id="email" placeholder="Email" required>
                        <label for="email">Email</label>
                        <div id="email-error" class="validation-error"></div>
                    </div>

                    <div class="form-floating">
                        <input type="password" class="form-control" name="password" id="password" placeholder="Password" required>
                        <label for="password">Password</label>
                        <div id="password-error" class="validation-error"></div>
                    </div>

                    <div class="form-floating">
                        <input type="password" class="form-control" name="confirm_password" id="confirm_password" placeholder="Confirm Password" required>
                        <label for="confirm_password">Confirm Password</label>
                        <div id="confirm-password-error" class="validation-error"></div>
                    </div>

                    <div class="form-floating">
                        <input type="text" class="form-control" name="referral_code" id="referral_code" placeholder="Referral Code (Optional)">
                        <label for="referral_code">Referral Code (Optional)</label>
                    </div>

                    <div class="terms-check">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="terms" required>
                            <label class="form-check-label" for="terms">
                                I agree to the terms & policy
                            </label>
                            <div id="terms-error" class="validation-error"></div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-signup">Sign Up</button>
                </form>

                <div class="divider">or</div>

                <a href="{% provider_login_url 'google' %}" class="btn-social">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-google" viewBox="0 0 16 16">
                        <path d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z"/>
                    </svg>
                    Sign up with Google
                </a>

                <div class="signin-link">
                    Already have an account? <a href="{% url 'login' %}">Sign In</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('signupForm').addEventListener('submit', function(event) {
            let valid = true;
            
            // Clear all error messages
            document.querySelectorAll('.validation-error').forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });

            const usernameInput = document.getElementById('username');
            const firstNameInput = document.getElementById('first_name');
            const lastNameInput = document.getElementById('last_name');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm_password');
            const termsInput = document.getElementById('terms');

            // Username validation: 3-20 characters, letters/numbers/underscores only
            const usernamePattern = /^[a-zA-Z0-9_]{3,20}$/;
            if (!usernamePattern.test(usernameInput.value)) {
                document.getElementById('username-error').textContent = 'Username must be 3-20 characters with only letters, numbers, and underscores';
                document.getElementById('username-error').style.display = 'block';
                valid = false;
            }

            // First name validation: letters only
            const namePattern = /^[a-zA-Z]+$/;
            if (!namePattern.test(firstNameInput.value)) {
                document.getElementById('first-name-error').textContent = 'First name must contain only letters';
                document.getElementById('first-name-error').style.display = 'block';
                valid = false;
            }

            // Last name validation: letters only
            if (!namePattern.test(lastNameInput.value)) {
                document.getElementById('last-name-error').textContent = 'Last name must contain only letters';
                document.getElementById('last-name-error').style.display = 'block';
                valid = false;
            }

            // Email validation
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(emailInput.value)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address';
                document.getElementById('email-error').style.display = 'block';
                valid = false;
            }

            // Password validation: At least 8 chars, one uppercase, one lowercase, one number, one special char
            const passwordPattern = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/;
            if (!passwordPattern.test(passwordInput.value)) {
                document.getElementById('password-error').textContent = 'Password must be 8+ characters with at least one uppercase letter, lowercase letter, number, and special character';
                document.getElementById('password-error').style.display = 'block';
                valid = false;
            }

            // Confirm password validation
            if (passwordInput.value !== confirmPasswordInput.value) {
                document.getElementById('confirm-password-error').textContent = 'Passwords do not match';
                document.getElementById('confirm-password-error').style.display = 'block';
                valid = false;
            }

            // Terms checkbox validation
            if (!termsInput.checked) {
                document.getElementById('terms-error').textContent = 'You must agree to the terms and policy';
                document.getElementById('terms-error').style.display = 'block';
                valid = false;
            }

            if (!valid) {
                event.preventDefault();
            }
        });

        // Real-time validation
        document.getElementById('username').addEventListener('input', validateUsername);
        document.getElementById('first_name').addEventListener('input', validateFirstName);
        document.getElementById('last_name').addEventListener('input', validateLastName);
        document.getElementById('email').addEventListener('input', validateEmail);
        document.getElementById('password').addEventListener('input', validatePassword);
        document.getElementById('confirm_password').addEventListener('input', validateConfirmPassword);

        function validateUsername() {
            const usernameInput = document.getElementById('username');
            const errorElement = document.getElementById('username-error');
            const usernamePattern = /^[a-zA-Z0-9_]{3,20}$/;
            
            if (usernameInput.value && !usernamePattern.test(usernameInput.value)) {
                errorElement.textContent = 'Username must be 3-20 characters with only letters, numbers, and underscores';
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }

        function validateFirstName() {
            const firstNameInput = document.getElementById('first_name');
            const errorElement = document.getElementById('first-name-error');
            const namePattern = /^[a-zA-Z]+$/;
            
            if (firstNameInput.value && !namePattern.test(firstNameInput.value)) {
                errorElement.textContent = 'First name must contain only letters';
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }

        function validateLastName() {
            const lastNameInput = document.getElementById('last_name');
            const errorElement = document.getElementById('last-name-error');
            const namePattern = /^[a-zA-Z]+$/;
            
            if (lastNameInput.value && !namePattern.test(lastNameInput.value)) {
                errorElement.textContent = 'Last name must contain only letters';
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }

        function validateEmail() {
            const emailInput = document.getElementById('email');
            const errorElement = document.getElementById('email-error');
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (emailInput.value && !emailPattern.test(emailInput.value)) {
                errorElement.textContent = 'Please enter a valid email address';
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }

        function validatePassword() {
            const passwordInput = document.getElementById('password');
            const errorElement = document.getElementById('password-error');
            const passwordPattern = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/;
            
            if (passwordInput.value && !passwordPattern.test(passwordInput.value)) {
                errorElement.textContent = 'Password must be 8+ characters with at least one uppercase letter, lowercase letter, number, and special character';
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
            
            // Also validate confirm password if it has a value
            if (document.getElementById('confirm_password').value) {
                validateConfirmPassword();
            }
        }

        function validateConfirmPassword() {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm_password');
            const errorElement = document.getElementById('confirm-password-error');
            
            if (confirmPasswordInput.value && confirmPasswordInput.value !== passwordInput.value) {
                errorElement.textContent = 'Passwords do not match';
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }
    </script>
</body>
</html>