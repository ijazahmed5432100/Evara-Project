{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--=============== FLATICON ===============-->
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/2.0.0/uicons-regular-straight/css/uicons-regular-straight.css"
    />

    <!--=============== SWIPER CSS ===============-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />


      <meta name="csrf-token" content="{{ csrf_token }}">

    

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    <title>Ecommerce Website</title>



    <style>
      /* Message Container - Centers messages */
.message-container {
  position: fixed;
  top: 16%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

/* Message Box Styling */
.alert {
  background-color: #333;
  color: white;
  padding: 15px 20px;
  border-radius: 8px;
  font-size: 16px;
  text-align: center;
  margin: 10px 0;
  min-width: 300px;
  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
  position: relative;
}

/* Success & Error Colors */
.alert-success { background-color: #28a745; }
.alert-error { background-color: #dc3545; }
.alert-warning { background-color: #ffc107; }

/* Close Button */
.close-btn {
  position: absolute;
  top: 5px;
  right: 10px;
  border: none;
  background: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
}
    </style>




  </head>
  <body>
    <!--=============== HEADER ===============-->

    {% include 'header.html' %}

    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== BREADCRUMB ===============-->
      <section class="breadcrumb">
        <ul class="breadcrumb__list flex container">
          <li><a href="{% url 'home' %}" class="breadcrumb__link">Home</a></li>
          <li><span class="breadcrumb__link"></span>></li>
          <li><a href="{% url 'all_products' %}" class="breadcrumb__link">Shop</a></li>
        </ul>
      </section>

      

      {% if messages %}
    <div class="message-container">
        {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                {{ message }}
                <button class="close-btn" onclick="this.parentElement.style.display='none';">&times;</button>
            </div>
        {% endfor %}
    </div>
{% endif %}









 <!-- Fully Isolated Premium Search Sidebar -->
<div class="evara-custom-search">
  <style scoped>
      /* Scoped styles that won't leak out */
      .evara-custom-search * {
          box-sizing: border-box;
          font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      
      .evara-custom-search {
          background-color: #ffffff;
          border-radius: 16px;
          box-shadow: 0 8px 30px rgba(0,0,0,0.08);
          padding: 30px;
          margin: 30px 0;
          width: 90%;
          max-width: 100%;
          margin-left: 5%;
          border: 1px solid rgba(0,0,0,0.03);
      }
      
      .evara-custom-search .evara-row {
          display: flex;
          flex-wrap: wrap;
          margin-right: -15px;
          margin-left: -15px;
          align-items: flex-end;
      }
      
      .evara-custom-search .evara-col {
          position: relative;
          width: 100%;
          padding-right: 15px;
          padding-left: 15px;
          margin-bottom: 15px;
      }
      
      @media (min-width: 992px) {
          .evara-custom-search .evara-col-lg-3 {
              flex: 0 0 25%;
              max-width: 25%;
          }
          
          .evara-custom-search .evara-col-lg-2 {
              flex: 0 0 16.666667%;
              max-width: 16.666667%;
          }
          
          .evara-custom-search .evara-col-lg-1 {
              flex: 0 0 8.333333%;
              max-width: 8.333333%;
          }
          
          .evara-custom-search .evara-divider {
              display: block;
          }
      }
      
      .evara-custom-search .evara-search-heading {
          color: #1a1a1a;
          font-size: 20px;
          font-weight: 600;
          margin-bottom: 18px;
          letter-spacing: -0.3px;
      }
      
      .evara-custom-search .evara-filter-heading {
          color: #1a1a1a;
          font-size: 16px;
          font-weight: 600;
          margin-bottom: 12px;
          letter-spacing: -0.2px;
      }
      
      .evara-custom-search .evara-input-wrapper {
          position: relative;
      }
      
      .evara-custom-search .evara-search-input {
          width: 100%;
          height: 46px;
          padding: 12px 18px;
          font-size: 14px;
          line-height: 1.5;
          color: #333;
          background-color: #fff;
          background-clip: padding-box;
          border: 1px solid #e0e0e0;
          border-radius: 10px;
          transition: all 0.3s ease;
          box-shadow: 0 2px 5px rgba(0,0,0,0.02);
      }
      
      .evara-custom-search .evara-search-input:focus {
          border-color: #00857c;
          box-shadow: 0 3px 8px rgba(0,133,124,0.1);
          outline: none;
      }
      
      .evara-custom-search .evara-search-button {
          background: transparent;
          border: none;
          color: #00857c;
          position: absolute;
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
          cursor: pointer;
          transition: all 0.2s ease;
      }
      
      .evara-custom-search .evara-search-button:hover {
          color: #006b63;
      }
      
      .evara-custom-search .evara-checkbox-wrapper {
          display: flex;
          gap: 20px;
      }
      
      .evara-custom-search .evara-checkbox-item {
          display: flex;
          align-items: center;
      }
      
      .evara-custom-search .evara-checkbox {
          width: 16px;
          height: 16px;
          margin-right: 5px;
          border-radius: 4px;
      }
      
      .evara-custom-search .evara-checkbox-label {
          color: #333;
          font-size: 14px;
          font-weight: 500;
      }
      
      .evara-custom-search .evara-dropdown, 
      .evara-custom-search .evara-sort-select {
          display: block;
          width: 100%;
          height: 46px;
          padding: 10px 16px;
          font-size: 14px;
          font-weight: 400;
          line-height: 1.5;
          color: #333;
          background-color: #fff;
          border: 1px solid #e0e0e0;
          border-radius: 10px;
          appearance: auto;
          transition: all 0.3s ease;
          box-shadow: 0 2px 5px rgba(0,0,0,0.02);
          cursor: pointer;
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2300857c' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
          background-repeat: no-repeat;
          background-position: calc(100% - 12px) center;
          padding-right: 35px;
      }
      
      .evara-custom-search .evara-dropdown:focus,
      .evara-custom-search .evara-sort-select:focus {
          border-color: #00857c;
          box-shadow: 0 3px 8px rgba(0,133,124,0.1);
          outline: none;
      }
      
      .evara-custom-search .evara-input-group {
          display: flex;
          gap: 10px;
          align-items: center;
      }
      
      .evara-custom-search .evara-input-group input {
          width: 50%;
          height: 46px;
          padding: 10px 16px;
          border: 1px solid #e0e0e0;
          border-radius: 10px;
          transition: all 0.3s ease;
          box-shadow: 0 2px 5px rgba(0,0,0,0.02);
          font-size: 14px;
      }
      
      .evara-custom-search .evara-input-group input:focus {
          border-color: #00857c;
          box-shadow: 0 3px 8px rgba(0,133,124,0.1);
          outline: none;
      }
      
      .evara-custom-search .evara-button {
          display: inline-block;
          font-weight: 500;
          text-align: center;
          vertical-align: middle;
          cursor: pointer;
          padding: 12px 22px;
          font-size: 14px;
          line-height: 1.5;
          border-radius: 30px;
          border: none;
          color: white;
          width: 100%;
          margin-bottom: 10px;
          transition: all 0.3s ease;
          letter-spacing: 0.3px;
          box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      }
      
      .evara-custom-search .evara-apply-button {
          background: linear-gradient(135deg, #00a79d 0%, #00857c 100%);
      }
      
      .evara-custom-search .evara-apply-button:hover {
          background: linear-gradient(135deg, #00857c 0%, #006b63 100%);
          box-shadow: 0 5px 15px rgba(0,133,124,0.2);
          transform: translateY(-2px);
      }
      
      .evara-custom-search .evara-clear-button {
          background: linear-gradient(135deg, #f44336 0%, #e53935 100%);
      }
      
      .evara-custom-search .evara-clear-button:hover {
          background: linear-gradient(135deg, #e53935 0%, #d32f2f 100%);
          box-shadow: 0 5px 15px rgba(229,57,53,0.2);
          transform: translateY(-2px);
      }
      
      .evara-custom-search .evara-col {
          transition: all 0.3s ease;
      }
      
      .evara-custom-search .evara-filter-container {
          background: #ffffff;
          border-radius: 12px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.05);
          padding: 20px;
          height: 100%;
          border: 1px solid rgba(0,0,0,0.03);
          transition: all 0.3s ease;
      }
      
      .evara-custom-search .evara-filter-container:hover {
          box-shadow: 0 8px 25px rgba(0,0,0,0.08);
          transform: translateY(-2px);
      }
      
      .evara-custom-search .evara-text-end {
          text-align: right;
      }
      
      /* Add some fancy hover effects */
      .evara-custom-search input::placeholder {
          color: #aaa;
          transition: all 0.3s ease;
      }
      
      .evara-custom-search input:focus::placeholder {
          opacity: 0.6;
      }
  </style>

  <!-- Single Form for All Filters -->
  <form method="GET" id="filter-form">
      <div class="evara-row">
          <!-- Filter by Category -->
          <div class="evara-col evara-col-lg-3">
              <div class="evara-filter-container">
                  <h4 class="evara-filter-heading">Filter by Category</h4>
                  <div class="evara-dropdown-wrapper">
                      <select name="categories" class="evara-dropdown" onchange="document.getElementById('filter-form').submit()">
                          <option value="">All Categories</option>
                          {% for category in categories %}
                          <option value="{{ category.id }}" {% if category.id in selected_categories %}selected{% endif %}>
                              {{ category.category_name }}
                          </option>
                          {% endfor %}
                      </select>
                  </div>
              </div>
          </div>

          <!-- Price Range Filter -->
          <div class="evara-col evara-col-lg-3">
              <div class="evara-filter-container">
                  <h4 class="evara-filter-heading">Filter by Price</h4>
                  <div class="evara-input-group">
                      <input type="number" name="min_price" value="{{ min_price }}" placeholder="Min Price">
                      <input type="number" name="max_price" value="{{ max_price }}" placeholder="Max Price">
                  </div>
              </div>
          </div>

          <!-- Sort Section -->
          <div class="evara-col evara-col-lg-3">
              <div class="evara-filter-container">
                  <h4 class="evara-filter-heading">Sort By</h4>
                  <select name="sort" class="evara-sort-select" onchange="document.getElementById('filter-form').submit()">
                      <option value="name-asc" {% if sort_option == "name-asc" %}selected{% endif %}>Name: A to Z</option>
                      <option value="name-desc" {% if sort_option == "name-desc" %}selected{% endif %}>Name: Z to A</option>
                      <option value="price-asc" {% if sort_option == "price-asc" %}selected{% endif %}>Price: Low to High</option>
                      <option value="price-desc" {% if sort_option == "price-desc" %}selected{% endif %}>Price: High to Low</option>
                  </select>
              </div>
          </div>

          <!-- Buttons Section -->
          <div class="evara-col evara-col-lg-3">
              <button type="submit" class="evara-button evara-apply-button filter-btn">Apply Filters</button>
              <button type="button" class="evara-button evara-clear-button clear-filters-btn" onclick="clearFilters()">Clear All Filters</button>
          </div>
      </div>
  </form>

  <!-- Add a small script for clearing filters -->
  <script>
    function clearFilters() {
      // Clear all form inputs
      const form = document.getElementById('filter-form');
      const inputs = form.querySelectorAll('input, select');
      inputs.forEach(input => {
        if (input.type === 'number' || input.type === 'text') {
          input.value = '';
        } else if (input.type === 'select-one') {
          input.selectedIndex = 0;
        }
      });
      // Submit the form with cleared values
      form.submit();
    }
  </script>
</div>



<div id="notification" class="notification"></div>

<style>
    .notification {
        position: fixed;
        top: 10px;
        right: 10px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border-radius: 5px;
        display: none;
    }
    .success {
        background-color: #4CAF50;
    }
    .error {
        background-color: #FF5733;
    }
</style>










      <!--=============== PRODUCTS ===============-->
      <section class="products container section--lg">
        <!-- <p class="total__products">We found <span>688</span> items for you!</p> -->
        <div class="products__container grid">

          {% if page_obj.paginator.count == 0 or page_obj.object_list|length == 0 %}
          <div class="no-products-message">
            <i class="bi bi-box-seam no-products-icon"></i>
            <p>No products found matching your search or filters. Please try a different search term or adjust your filters.</p>
            <a href="{% url 'all_products' %}" class="btn btn-outline-primary mt-3">Reset and Browse All</a>
          </div>
          {% else %}

          {% for item in products %}
          <div class="product__item">
            <div class="product__banner">
              <a href="{% url 'product_details' item.product.id %}" class="product__images">
                <img
                src="{{ item.first_image.image.url }}"       
                  alt="{{item.product.name}}"
                  class="product__img default"
                />
                <img
                  src="{{ item.first_image.image.url }}"
                  alt="{{item.product.name}}"
                  class="product__img hover"
                />
              </a>
              <div class="product__actions">
                <a href="{% url 'product_details' item.product.id %}" class="action__btn" aria-label="Quick View">
                  <i class="fi fi-rs-eye"></i>
                </a>


                <a href="#" 
                  onclick="event.preventDefault(); addToWishlist({{ item.product.id }})"
                  class="action__btn"
                  aria-label="Add to Wishlist">
                  <i class="fi fi-rs-heart"></i>
                </a>

                
              </div>
              {% if item.product.has_offer %}
              <div class="product__badge light-pink">{{ item.product.best_offer_percentage }}% OFF</div>
              {% endif %}
            </div>
            <div class="product__content">
              <span class="product__category">Clothing</span>
              <a href="{% url 'product_details' item.product.id %}">
                <h3 class="product__title">{{item.product.name}}</h3>
              </a>
              <div class="product__rating">
                {% for i in "12345" %}
                  <span
                  class="star {% if i <= item.product.average_rating|floatformat:0 %}filled{% else %}empty{% endif %}">&#9733;</span>
                {% endfor %}
              </div>
              <div class="product__price flex">
                {% if item.product.has_offer %}
                <span class="new__price">{{ item.product.best_offer_price|floatformat:2 }}</span>
                <span class="old__price">{{item.product.price | floatformat:2}}</span>
                {% else %}
                <span class="new__price">{{item.product.price | floatformat:2}}</span>
                {% endif %}
              </div>
              <!-- <a
                href=""
                class="action__btn cart__btn"
                aria-label="Add To Cart"
              >
                <i class="fi fi-rs-shopping-bag-add"></i>
              </a> -->
            </div>
          </div>
          {% endfor %}
          {% endif %} 
         










          <!-- 
              <div class="product__actions">
                <a href="#" class="action__btn" aria-label="Quick View">
                  <i class="fi fi-rs-eye"></i>
                </a>
                
                  href="#"
                  class="action__btn"
                  aria-label="Add to Wishlist"
                >
                  <i class="fi fi-rs-heart"></i>
                </a>
                <a href="#" class="action__btn" aria-label="Compare">
                  <i class="fi fi-rs-shuffle"></i>
                </a>
              </div>
            </div>
            <div class="product__content">
              <span class="product__category">Clothing</span>
              <a href="details.html">
                <h3 class="product__title">Colorful Pattern Shirts</h3>
              </a>
              <div class="product__rating">
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
              </div>
              <div class="product__price flex">
                <span class="new__price">$238.85</span>
                <span class="old__price">$245.8</span>
              </div>
              
                href="#"
                class="action__btn cart__btn"
                aria-label="Add To Cart"
              >
                <i class="fi fi-rs-shopping-bag-add"></i>
              </a>
            </div>
          </div>-->
        </div>
        








        {% if page_obj.paginator.count > 0 %}
            <ul class="pagination">
                {% if page_obj.has_previous %}
                <li>
                    <a href="?page={{ page_obj.previous_page_number }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}&min_price={{ min_price }}&max_price={{ max_price }}" 
                        class="pagination__link icon">
                        <i class="fi-rs-angle-double-small-left"></i>
                    </a>
                </li>
                {% endif %}
            
                {% for num in page_obj.paginator.page_range %}
                    {% if num == page_obj.number %}
                        <li><a href="#" class="pagination__link active">{{ num|stringformat:"02d" }}</a></li>
                    {% elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
                        <li>
                            <a href="?page={{ num }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}&min_price={{ min_price }}&max_price={{ max_price }}" 
                                class="pagination__link">
                                {{ num|stringformat:"02d" }}
                            </a>
                        </li>
                    {% elif num == 1 or num == page_obj.paginator.num_pages %}
                        <li>
                            <a href="?page={{ num }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}&min_price={{ min_price }}&max_price={{ max_price }}" 
                                class="pagination__link">
                                {{ num }}
                            </a>
                        </li>
                    {% elif num == page_obj.number|add:"-3" or num == page_obj.number|add:"3" %}
                        <li><a href="#" class="pagination__link">...</a></li>
                    {% endif %}
                {% endfor %}
            
                {% if page_obj.has_next %}
                <li>
                    <a href="?page={{ page_obj.next_page_number }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}&min_price={{ min_price }}&max_price={{ max_price }}" 
                        class="pagination__link icon">
                        <i class="fi-rs-angle-double-small-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
            {% endif %}
        
        </section>
        
       
        </main>
        
        <!--=============== FOOTER ===============-->
        
        {% include 'footer.html' %}
        <!--=============== SWIPER JS ===============-->
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
        
        <!--=============== MAIN JS ===============-->
        <script src="{% static 'js/main.js' %}"></script>







        <script>
          document.addEventListener("DOMContentLoaded", function() {
            let minPriceInput = document.querySelector("input[name='min_price']");
            let maxPriceInput = document.querySelector("input[name='max_price']");

            // Prevent auto-submit on price input change
            [minPriceInput, maxPriceInput].forEach(input => {
                input.addEventListener("change", function(e) {
                    e.preventDefault(); // Prevent form submission
                    // Optionally, you can add validation or UI feedback here
                });
            });

            // Trigger form submission only with the main Apply Filters button
            document.querySelector('.filter-btn').addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default form submission
                document.getElementById('filter-form').submit(); // Submit the main form
            });
        });






        

        // Clear all filters function (moved outside DOMContentLoaded)
        function clearFilters() {
          // Reset input fields
          document.querySelector("input[name='search']").value = "";
          document.querySelector("input[name='min_price']").value = "";
          document.querySelector("input[name='max_price']").value = "";
          document.querySelector("select[name='categories']").value = "";
          document.querySelector("select[name='sort']").value = "";

          // Submit the form to clear filters
          document.getElementById('filter-form').submit();
      }




          

          function addToWishlist(productId) {

            function getCSRFToken() {
              let token = document.querySelector("[name=csrf-token]")?.content;
              if (!token) {
                  console.error("CSRF token not found!");
              }
              return token;
          }
          


            fetch(`/wishlist/add/${productId}/`, {
                method: "POST",
                headers: { 
                    "X-CSRFToken": getCSRFToken() 
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    showNotification(data.message, "success");
                } else {
                    showNotification(data.message, "error");
                }
            })
            .catch(error => console.error("Error:", error));
        }
    
        function showNotification(message, type) {
            let notification = document.getElementById("notification");
            notification.textContent = message;
            notification.classList.add(type === "success" ? "success" : "error");
            notification.style.display = "block";
    
            setTimeout(() => {
                notification.style.display = "none";
            }, 3000);
        }
    
        function getCSRFToken() {
            return document.querySelector('[name=csrfmiddlewaretoken]').value;
        }










      </script>
      


        




        </body>


        </html>