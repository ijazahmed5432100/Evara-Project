{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--=============== FLATICON ===============-->
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/2.0.0/uicons-regular-straight/css/uicons-regular-straight.css"
    />

    <!--=============== SWIPER CSS ===============-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />


      <meta name="csrf-token" content="{{ csrf_token }}">

    

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    <title>Ecommerce Website</title>



    <style>
      /* Message Container - Centers messages */
.message-container {
  position: fixed;
  top: 16%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

/* Message Box Styling */
.alert {
  background-color: #333;
  color: white;
  padding: 15px 20px;
  border-radius: 8px;
  font-size: 16px;
  text-align: center;
  margin: 10px 0;
  min-width: 300px;
  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
  position: relative;
}

/* Success & Error Colors */
.alert-success { background-color: #28a745; }
.alert-error { background-color: #dc3545; }
.alert-warning { background-color: #ffc107; }

/* Close Button */
.close-btn {
  position: absolute;
  top: 5px;
  right: 10px;
  border: none;
  background: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
}
    </style>




  </head>
  <body>
    <!--=============== HEADER ===============-->

    {% include 'header.html' %}

    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== BREADCRUMB ===============-->
      <section class="breadcrumb">
        <ul class="breadcrumb__list flex container">
          <li><a href="index.html" class="breadcrumb__link">Home</a></li>
          <li><span class="breadcrumb__link"></span>></li>
          <li><span class="breadcrumb__link">Shop</span></li>
        </ul>
      </section>

      

      {% if messages %}
    <div class="message-container">
        {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                {{ message }}
                <button class="close-btn" onclick="this.parentElement.style.display='none';">&times;</button>
            </div>
        {% endfor %}
    </div>
{% endif %}









      <!-- Fully Isolated Search Sidebar -->
<div class="evara-custom-search">
  <style scoped>
      /* Scoped styles that won't leak out */
      .evara-custom-search * {
          box-sizing: border-box;
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      
      .evara-custom-search {
          background-color: #fff;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.08);
          padding: 20px;
          margin: 20px 0;
          width: 81%;
          max-width: 100%;
          margin-left: 10%;
          
          
          align-content: center;
      }
      
      .evara-custom-search .evara-row {
          display: flex;
          flex-wrap: wrap;
          margin-right: -15px;
          margin-left: -15px;
      }
      
      .evara-custom-search .evara-col {
          position: relative;
          width: 100%;
          padding-right: 15px;
          padding-left: 15px;
          margin-bottom: 15px;
      }
      
      @media (min-width: 992px) {
          .evara-custom-search .evara-col-lg-3 {
              flex: 0 0 25%;
              max-width: 25%;
          }
          
          .evara-custom-search .evara-col-lg-2 {
              flex: 0 0 16.666667%;
              max-width: 16.666667%;
          }
          
          .evara-custom-search .evara-col-lg-1 {
              flex: 0 0 8.333333%;
              max-width: 8.333333%;
          }
          
          .evara-custom-search .evara-divider {
              display: block;
          }
      }
      
      .evara-custom-search .evara-search-heading {
          color: #2c3e50;
          font-size: 18px;
          font-weight: 600;
          margin-bottom: 15px;
      }
      
      .evara-custom-search .evara-filter-heading {
          color: #2c3e50;
          font-size: 16px;
          font-weight: 600;
          margin-bottom: 10px;
      }
      
      .evara-custom-search .evara-input-wrapper {
          position: relative;
      }
      
      .evara-custom-search .evara-search-input {
          width: 100%;
          height: 38px;
          padding: 8px 15px;
          font-size: 14px;
          line-height: 1.5;
          color: #495057;
          background-color: #fff;
          background-clip: padding-box;
          border: 1px solid #ced4da;
          border-radius: 6px;
          transition: border-color .15s ease-in-out;
      }
      
      .evara-custom-search .evara-search-button {
          background: transparent;
          border: none;
          color: #00857c;
          position: absolute;
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
          cursor: pointer;
      }
      
      .evara-custom-search .evara-checkbox-wrapper {
          display: flex;
          gap: 20px;
      }
      
      .evara-custom-search .evara-checkbox-item {
          display: flex;
          align-items: center;
      }
      
      .evara-custom-search .evara-checkbox {
          width: 16px;
          height: 16px;
          margin-right: 5px;
      }
      
      .evara-custom-search .evara-checkbox-label {
          color: #2c3e50;
          font-size: 14px;
          font-weight: 500;
      }
      
      .evara-custom-search .evara-sort-select {
          display: block;
          width: 100%;
          height: calc(1.5em + 0.75rem + 2px);
          padding: 0.375rem 0.75rem;
          font-size: 14px;
          font-weight: 400;
          line-height: 1.5;
          color: #495057;
          background-color: #fff;
          border: 1px solid #ced4da;
          border-radius: 6px;
          appearance: auto;
      }
      
      .evara-custom-search .evara-button {
          display: inline-block;
          font-weight: 500;
          text-align: center;
          vertical-align: middle;
          cursor: pointer;
          padding: 0.375rem 0.75rem;
          font-size: 14px;
          line-height: 1.5;
          border-radius: 20px;
          border: none;
          color: white;
          width: 100%;
          margin-bottom: 10px;
      }
      
      .evara-custom-search .evara-apply-button {
          background-color: #00857c;
      }
      
      .evara-custom-search .evara-apply-button:hover {
          background-color: #006b63;
      }
      
      .evara-custom-search .evara-clear-button {
          background-color: #e74c3c;
      }
      
      .evara-custom-search .evara-clear-button:hover {
          background-color: #c0392b;
      }
      
      .evara-custom-search .evara-divider {
          width: 1px;
          background-color: #eee;
          margin: 0 auto;
          height: 100%;
          display: none;
      }
      
      .evara-custom-search .evara-text-end {
          text-align: right;
      }
  </style>

  





  <div class="evara-row">
    <!-- Search Section -->
    <div class="evara-col evara-col-lg-3">
        <h3 class="evara-search-heading">Search Products</h3>
        <form method="GET" class="evara-search-form">
            <div class="evara-input-wrapper">
                <input type="text" class="evara-search-input" name="search" value="{{ search_query }}" placeholder="Search products...">
                <button class="evara-search-button" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </button>
            </div>
        </form>
    </div>

    <!-- <div class="evara-col evara-col-lg-1">
        <div class="evara-divider"></div>
    </div> -->

   <!-- Filter Section -->
<div class="evara-col evara-col-lg-3" style=" background: #ffffff; border-radius: 8px; box-shadow: 2px 2px 10px rgba(255, 255, 255, 0.1); margin-left:35px ">
  <h4 class="evara-filter-heading" style="margin-bottom: 10px; font-size: 18px; font-weight: bold; color: #333;">Filter by Category</h4>
  <form method="GET">
      <input type="hidden" name="search" value="{{ search_query }}">
      <input type="hidden" name="sort" value="{{ sort_option }}">

      <div class="evara-dropdown-wrapper" style="width: 100%; margin-bottom: 10px;">
          <select name="categories" class="evara-dropdown" onchange="this.form.submit()" 
              style="width: 100%; padding: 10px; margin-top: 4px; border: 1px solid #ccc; border-radius: 5px; background: #fff; font-size: 16px; color: #808080; cursor: pointer; height: 38px; padding: 8px 15px; ">
              <option value="">All Categories</option>
              {% for category in categories %}
              <option value="{{ category.id }}" {% if category.id in selected_categories %}selected{% endif %}>
                  {{ category.category_name }}
              </option>
              {% endfor %}
          </select>
      </div>
  </form>
</div>









<!-- Price Range Filter -->
<div class="evara-col evara-col-lg-3" style="background: #ffffff; border-radius: 8px; box-shadow: 2px 2px 10px rgba(255, 255, 255, 0.1); margin-left:35px ">
  <h4 class="evara-filter-heading" style="margin-bottom: 10px; font-size: 18px; font-weight: bold; color: #333;">Filter by Price</h4>
  
  <form method="GET">
      <input type="hidden" name="search" value="{{ search_query }}">
      <input type="hidden" name="sort" value="{{ sort_option }}">
      {% for category in selected_categories %}
      <input type="hidden" name="categories" value="{{ category }}">
      {% endfor %}

      <!-- Price Inputs -->
      <div class="evara-input-group" style="display: flex; gap: 10px; align-items: center;" >
          <input type="number" name="min_price" value="{{ min_price }}" placeholder="Min Price" 
              style="width: 50%; margin-top: 4px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; color: #333; height: 38px; padding: 8px 15px; ">
          <input type="number" name="max_price" value="{{ max_price }}" placeholder="Max Price" 
              style=" width: 50%; margin-top: 4px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; color: #333; height: 38px; padding: 8px 15px; ">
      </div>

      <!-- Apply Button -->
      <button class="evara-button evara-apply-button filter-btn" type="submit" 
          style="margin-top: 12px; margin-left: 40%; width: 20%; height: 30px; background: #007bff; color: #fff; border: none; padding: 5px; border-radius: 6px; cursor: pointer; font-weight: bold; ">
          Apply
      </button>
  </form>
</div>









    <!-- <div class="evara-col evara-col-lg-1">
        <div class="evara-divider"></div>
    </div> -->

    <!-- Sort Section -->
    <div class="evara-col evara-col-lg-2" style="margin-left:35px" >
        <h4 class="evara-filter-heading">Sort By</h4>
        <input type="hidden" name="search" value="{{ search_query }}">
        {% for category in selected_categories %}
        <input type="hidden" name="categories" value="{{ category }}">
        {% endfor %}
        <select name="sort" class="evara-sort-select" onchange="this.form.submit() " style="margin-top: 16px; height: 38px; padding: 8px 15px; color: #808080; " >
            <option value="name-asc" {% if sort_option == "name-asc" %}selected{% endif %}>Name: A to Z</option>
            <option value="name-desc" {% if sort_option == "name-desc" %}selected{% endif %}>Name: Z to A</option>
            <option value="price-asc" {% if sort_option == "price-asc" %}selected{% endif %}>Price: Low to High</option>
            <option value="price-desc" {% if sort_option == "price-desc" %}selected{% endif %}>Price: High to Low</option>
        </select>
    </div>

    <!-- Buttons Section -->
    <div class="evara-col evara-col-lg-2 evara-text-end" style="margin-left: 43%;"  >
        <button class="evara-button evara-apply-button filter-btn" type="submit">Apply Filters</button>
        </form> <!-- Closing the main filter form properly -->

        <form method="GET">
            <button type="submit" class="evara-button evara-clear-button clear-filters-btn">Clear All Filters</button>
        </form>
    </div>
</div>
</div>





<div id="notification" class="notification"></div>

<style>
    .notification {
        position: fixed;
        top: 10px;
        right: 10px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border-radius: 5px;
        display: none;
    }
    .success {
        background-color: #4CAF50;
    }
    .error {
        background-color: #FF5733;
    }
</style>










      <!--=============== PRODUCTS ===============-->
      <section class="products container section--lg">
        <!-- <p class="total__products">We found <span>688</span> items for you!</p> -->
        <div class="products__container grid">
          {% for item in products %}
          <div class="product__item">
            <div class="product__banner">
              <a href="details.html" class="product__images">
                <img
                src="{{ item.first_image.image.url }}"       
                  alt="{{item.product.name}}"
                  class="product__img default"
                />
                <img
                  src="{{ item.first_image.image.url }}"
                  alt="{{item.product.name}}"
                  class="product__img hover"
                />
              </a>
              <div class="product__actions">
                <a href="{% url 'product_details' item.product.id %}" class="action__btn" aria-label="Quick View">
                  <i class="fi fi-rs-eye"></i>
                </a>


                <a href="#" 
                  onclick="event.preventDefault(); addToWishlist({{ item.product.id }})"
                  class="action__btn"
                  aria-label="Add to Wishlist">
                  <i class="fi fi-rs-heart"></i>
                </a>

                
              </div>
              <div class="product__badge light-pink">Hot</div>
            </div>
            <div class="product__content">
              <span class="product__category">Clothing</span>
              <a href="details.html">
                <h3 class="product__title">{{item.product.name}}</h3>
              </a>
              <div class="product__rating">
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
              </div>
              <div class="product__price flex">
                <span class="new__price">{{item.product.price | floatformat:2}}</span>
                <span class="old__price">2000</span>
              </div>
              <!-- <a
                href=""
                class="action__btn cart__btn"
                aria-label="Add To Cart"
              >
                <i class="fi fi-rs-shopping-bag-add"></i>
              </a> -->
            </div>
          </div>
          {% endfor %}
         










          <!-- 
              <div class="product__actions">
                <a href="#" class="action__btn" aria-label="Quick View">
                  <i class="fi fi-rs-eye"></i>
                </a>
                
                  href="#"
                  class="action__btn"
                  aria-label="Add to Wishlist"
                >
                  <i class="fi fi-rs-heart"></i>
                </a>
                <a href="#" class="action__btn" aria-label="Compare">
                  <i class="fi fi-rs-shuffle"></i>
                </a>
              </div>
            </div>
            <div class="product__content">
              <span class="product__category">Clothing</span>
              <a href="details.html">
                <h3 class="product__title">Colorful Pattern Shirts</h3>
              </a>
              <div class="product__rating">
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
                <i class="fi fi-rs-star"></i>
              </div>
              <div class="product__price flex">
                <span class="new__price">$238.85</span>
                <span class="old__price">$245.8</span>
              </div>
              
                href="#"
                class="action__btn cart__btn"
                aria-label="Add To Cart"
              >
                <i class="fi fi-rs-shopping-bag-add"></i>
              </a>
            </div>
          </div>-->
        </div>
        








        {% if page_obj.paginator.count > 0 %}
        <ul class="pagination">
            {% if page_obj.has_previous %}
            <li>
                <a href="?page={{ page_obj.previous_page_number }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}" 
                    class="pagination__link icon">
                    <i class="fi-rs-angle-double-small-left"></i>
                </a>
            </li>
            {% endif %}
        
            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <li><a href="#" class="pagination__link active">{{ num|stringformat:"02d" }}</a></li>
                {% elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
                    <li>
                        <a href="?page={{ num }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}" 
                            class="pagination__link">
                            {{ num|stringformat:"02d" }}
                        </a>
                    </li>
                {% elif num == 1 or num == page_obj.paginator.num_pages %}
                    <li>
                        <a href="?page={{ num }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}" 
                            class="pagination__link">
                            {{ num }}
                        </a>
                    </li>
                {% elif num == page_obj.number|add:"-3" or num == page_obj.number|add:"3" %}
                    <li><a href="#" class="pagination__link">...</a></li>
                {% endif %}
            {% endfor %}
        
            {% if page_obj.has_next %}
            <li>
                <a href="?page={{ page_obj.next_page_number }}&search={{ search_query }}&sort={{ sort_option }}{% for category in selected_categories %}&categories={{ category }}{% endfor %}" 
                    class="pagination__link icon">
                    <i class="fi-rs-angle-double-small-right"></i>
                </a>
            </li>
            {% endif %}
        </ul>
        {% endif %}
        
        </section>
        
       
        </main>
        
        <!--=============== FOOTER ===============-->
        
        {% include 'footer.html' %}
        <!--=============== SWIPER JS ===============-->
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
        
        <!--=============== MAIN JS ===============-->
        <script src="{% static 'js/main.js' %}"></script>







        <script>
          document.addEventListener("DOMContentLoaded", function() {
              let minPriceInput = document.querySelector("input[name='min_price']");
              let maxPriceInput = document.querySelector("input[name='max_price']");
              
              [minPriceInput, maxPriceInput].forEach(input => {
                  input.addEventListener("change", function() {
                      this.form.submit();  // Auto-submit form on input change
                  });
              });
          });





          

          function addToWishlist(productId) {

            function getCSRFToken() {
              let token = document.querySelector("[name=csrf-token]")?.content;
              if (!token) {
                  console.error("CSRF token not found!");
              }
              return token;
          }
          


            fetch(`/wishlist/add/${productId}/`, {
                method: "POST",
                headers: { 
                    "X-CSRFToken": getCSRFToken() 
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    showNotification(data.message, "success");
                } else {
                    showNotification(data.message, "error");
                }
            })
            .catch(error => console.error("Error:", error));
        }
    
        function showNotification(message, type) {
            let notification = document.getElementById("notification");
            notification.textContent = message;
            notification.classList.add(type === "success" ? "success" : "error");
            notification.style.display = "block";
    
            setTimeout(() => {
                notification.style.display = "none";
            }, 3000);
        }
    
        function getCSRFToken() {
            return document.querySelector('[name=csrfmiddlewaretoken]').value;
        }










      </script>
      


        




        </body>


        </html>